import{_ as x}from"./app.523dd8ec.js";import{o as a,e as r,j as t,K as m,M as b,h as c,F as f,J as v,x as n,N as y,k,I as _,H as w,L as C}from"./vue.esm-bundler.5523ad96.js";const E={data:function(){return{permissions:[],permission_roles:[],roles_loading:!0,permissions_loading:!0,permissions_empty:!1,loading:!0,form_title:"Nuevo Permiso",form_data:{id:"",name:""},form_action:"",form_error:"",form_okbtn_text:"Aceptar",form_color:"green",form_loading:!1,delete_text:"Eliminar",delete_id:"",delete_permission:"",delete_error:"",delete_loading:!1,session:JSON.parse(sessionStorage.getItem("semtinel"))}},created(){},watch:{form_okbtn_text:function(e){e=="Aceptar"?this.form_loading=!1:this.form_loading=!0},form_action:function(e){switch(e){case"create":this.form_color="green";break;case"edit":this.form_color="orange";break;default:this.form_color="danger";break}}},methods:{listReload:function(){this.getItemsTable()},async getItemsTable(){let e=this,o={"User-Agent":"testing/1.0",Accept:"application/json",Authorization:"Bearer "+e.session.access_token};e.permissions_loading=!0,fetch("http://localhost/semtinel/api/admin/permissions",{method:"GET",headers:o}).then(s=>s.json()).then(s=>{e.permissions=s,e.permissions_loading=!1,e.permissions_empty=!(s.length>0)}).catch(s=>{this.errorMessage=s,toastr.error("Error: "+s)})},activeRole:function(e){this.permission_roles[e].active=!this.permission_roles[e].active},isValidForm:function(){return this.form_data.name==null||this.form_data.name==""?(this.form_error="Debe escribir un Nombre para el permiso.",!1):!0},create:function(){let e=this;if(e.form_action="create",e.form_error="",e.form_title="Nuevo Permiso",e.form_data.id="",e.form_data.name="",e.permission_roles.length>0)e.permission_roles.forEach((o,s)=>{o.active=!1});else{e.roles_loading=!0;let o={"User-Agent":"testing/1.0",Accept:"application/json",Authorization:"Bearer "+e.session.access_token};fetch("http://localhost/semtinel/api/admin/permission/roles/0",{method:"GET",headers:o}).then(s=>s.json()).then(s=>{e.permission_roles=s,e.roles_loading=!1}).catch(s=>{this.errorMessage=s,toastr.error("Error: "+s)})}},edit:function(e,o){let s=this;s.form_action="edit",s.form_error="",s.form_title="Editar Permiso",s.form_data.id=e,s.form_data.name=o,s.roles_loading=!0;let u={"User-Agent":"testing/1.0",Accept:"application/json",Authorization:"Bearer "+s.session.access_token};fetch("http://localhost/semtinel/api/admin/permission/roles/"+e,{method:"GET",headers:u}).then(l=>l.json()).then(l=>{s.permission_roles=l,s.roles_loading=!1}).catch(l=>{this.errorMessage=l,toastr.error("Error: "+l)})},deleteDialog:function(e,o){this.delete_id=e,this.delete_permission=o},async store(){let e=this;if(!e.isValidForm())return;e.form_error="",e.form_okbtn_text="Procesando...";let o={"User-Agent":"testing/1.0",Accept:"application/json",Authorization:"Bearer "+e.session.access_token};await axios.post("http://localhost/semtinel/api/admin/permission",{id:e.form_data.id,name:e.form_data.name,roles:this.permission_roles},{headers:o}).then(function(s){s.data.success?(e.form_error="",e.form_okbtn_text="Aceptar",e.$refs.Close.click(),e.form_action=="create"?toastr.success("El Permiso fue Agregado con \xE9xito."):e.form_action=="edit"&&toastr.success("El Permiso fue Actualizado con \xE9xito."),e.listReload()):(e.form_error="",e.form_okbtn_text="Aceptar",e.error("Error al intentar realizar la operaci\xF3n."))}).catch(function(s){e.form_error="Ha ocurrido un error. Por favor, prueba nuevamente.",e.form_okbtn_text="Aceptar"})},async destroy(){let e=this;e.delete_error="",e.delete_loading=!0,e.delete_text="Procesando...";let o={"User-Agent":"testing/1.0",Accept:"application/json",Authorization:"Bearer "+e.session.access_token};await axios.delete("http://localhost/semtinel/api/admin/permission/"+e.delete_id,{headers:o},{}).then(function(s){s.data.success?(e.delete_error="",e.delete_loading=!1,e.delete_text="Eliminar",e.$refs.delClose.click(),toastr.success("El Permiso fue Eliminado con \xE9xito."),e.listReload()):(e.delete_error="",e.delete_loading=!1,e.delete_text="Eliminar",toastr.error("Error al intentar realizar la operaci\xF3n."))}).catch(function(s){e.delete_error="Ha ocurrido un error. Por favor, prueba nuevamente.",e.form_okbtn_text="Eliminar",e.delete_loading=!1})}},mounted(){JSON.parse(sessionStorage.getItem("semtinel")).access_token||(sessionStorage.clear(),window.document.location.href="http://localhost/semtinel/login"),this.getItemsTable()}},A={class:"container-fluid px-0"},N={class:"card card-default"},P={class:"card-header"},j=t("h3",{class:"card-title"},"Permisos",-1),z={class:"card-tools"},R=t("i",{class:"mdi mdi-reload mdi-24px text-green"},null,-1),S=[R],B=t("i",{class:"mdi mdi-plus-circle mdi-24px text-green"},null,-1),M=[B],T={class:"card-body"},V=t("div",{class:"col-12 text-center py-5 loading-table"},[t("h6",null,[t("span",{class:"mdi mdi-loading mdi-spin mdi-36px"},"\xA0Cargando permisos...")])],-1),U=[V],D=t("div",{class:"col-12 text-center empty-table"},[t("h6",null,"Ning\xFAn Rol encontrado")],-1),I=[D],$={class:"col-12"},F={class:"table table-striped"},G=t("thead",null,[t("tr",null,[t("th",{width:"50",class:"text-center no-sort"},"No."),t("th",null,"Nombre"),t("th",{width:"100",class:"text-center no-sort"},"Modificar"),t("th",{width:"100",class:"text-center no-sort"},"Eliminar")])],-1),H={class:"text-center"},J={class:"text-center"},L=["onClick"],q=t("span",{class:"mdi mdi-pencil mdi-18px text-orange"},null,-1),O=[q],K={class:"text-center"},Q=["onClick"],W=t("span",{class:"mdi mdi-trash-can-outline mdi-18px text-danger"},null,-1),X=[W],Y={class:"modal fade",id:"modal-permission-form","aria-hidden":"true",role:"dialog","data-backdrop":"static","data-keyboard":"false"},Z={class:"modal-dialog"},ee={class:"modal-content"},te={class:"modal-title"},se={type:"button",ref:"Close",class:"close","data-dismiss":"modal","aria-label":"Close"},oe=t("span",{"aria-hidden":"true"},"\xD7",-1),ie=[oe],ae={class:"modal-body px-4"},re={class:"row"},ne={class:"col-md-12"},le={class:"form-group"},de=t("label",{for:"name"},"Nombre:",-1),ce={key:0,class:"row pt-2"},me={class:"col-12 text-center"},_e={class:"form_error"},he={class:"card card-default"},pe=w('<div class="card-header"><h3 class="card-title">Roles</h3><div class="card-tools"><button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i></button></div></div>',1),fe={class:"card-body"},ue=t("div",{class:"col-12 text-center py-5 loading-table"},[t("h6",null,[t("span",{class:"mdi mdi-loading mdi-spin mdi-36px"},"\xA0Cargando roles...")])],-1),ge=[ue],be={class:"col-12"},ve={class:"table table-striped"},ye=t("thead",null,[t("tr",null,[t("th",{width:"50",class:"text-center no-sort"},"No."),t("th",null,"Nombre"),t("th",{width:"100",class:"text-center no-sort"},"Permite")])],-1),ke={class:"text-center"},xe={class:"text-center"},we=["checked","onChange"],Ce={class:"modal-footer justify-content-between"},Ee=t("button",{type:"button",class:"btn btn-default ripple","data-dismiss":"modal"},"Cancelar",-1),Ae=["disabled"],Ne={key:0,class:"mdi mdi-check-all"},Pe={key:1,class:"mdi mdi-loading mdi-spin"},je={class:"modal fade",id:"modal-permission-delete","aria-hidden":"true",role:"dialog","data-backdrop":"static","data-keyboard":"false"},ze={class:"modal-dialog modal-lg"},Re={class:"modal-content"},Se={class:"modal-header header-danger"},Be=t("h4",{class:"modal-title"},"Confirmaci\xF3n",-1),Me={type:"button",ref:"delClose",class:"close","data-dismiss":"modal","aria-label":"Close"},Te=t("span",{"aria-hidden":"true"},"\xD7",-1),Ve=[Te],Ue={class:"modal-body px-4"},De=t("div",{class:"float-start",style:{width:"70px"}},[t("i",{class:"mdi mdi-chat-question mdi-48px"})],-1),Ie={class:"float-start pt-3",style:{width:"85%"}},$e=t("br",null,null,-1),Fe={key:0,class:"row pt-2"},Ge={class:"col-12 text-center"},He={class:"form_error"},Je={class:"modal-footer justify-content-between"},Le=t("button",{type:"button",class:"btn btn-default","data-dismiss":"modal"},"Cancelar",-1),qe=["disabled"],Oe=t("i",{class:"mdi mdi-trash-can-outline"},null,-1);function Ke(e,o,s,u,l,d){const h=C("tooltip");return a(),r(f,null,[t("div",A,[t("div",N,[t("div",P,[j,t("div",z,[m((a(),r("button",{type:"button",class:"btn btn-tool pl-0",onClick:o[0]||(o[0]=b(i=>d.listReload(),["stop"]))},S)),[[h,"Recargar Listado"]]),m((a(),r("button",{type:"button",class:"btn btn-tool pl-0","data-toggle":"modal","data-target":"#modal-permission-form",onClick:o[1]||(o[1]=i=>d.create())},M)),[[h,"Nuevo Permiso"]])])]),t("div",T,[t("div",{class:c(["row mt-3",e.permissions_loading?"":"hidden"])},U,2),t("div",{class:c(["row mt-3",e.permissions_empty?"":"hidden"])},I,2),t("div",{class:c(["row",!e.permissions_loading&&!e.permissions_empty?"":"hidden"])},[t("div",$,[t("table",F,[G,t("tbody",null,[(a(!0),r(f,null,v(e.permissions,(i,p)=>(a(),r("tr",{key:i.id},[t("td",H,n(p+1),1),t("td",null,n(i.name),1),t("td",J,[m((a(),r("a",{href:"javascript:void(0);",class:"btn-semti-tool",style:{padding:"4px 5px"},"data-toggle":"modal","data-target":"#modal-permission-form",onClick:g=>d.edit(i.id,i.name)},O,8,L)),[[h,"Modificar este Permiso"]])]),t("td",K,[m((a(),r("a",{href:"javascript:void(0);",class:"btn-semti-tool",style:{padding:"4px 5px"},"data-toggle":"modal","data-target":"#modal-permission-delete",onClick:g=>d.deleteDialog(i.id,i.name)},X,8,Q)),[[h,"Eliminar este Permiso"]])])]))),128))])])])],2)])])]),t("div",Y,[t("div",Z,[t("div",ee,[t("div",{class:c(["modal-header","header-"+e.form_color])},[t("h4",te,n(e.form_title),1),t("button",se,ie,512)],2),t("div",ae,[t("form",null,[m(t("input",{type:"hidden",name:"id_permission",id:"id_permission","onUpdate:modelValue":o[2]||(o[2]=i=>e.form_data.id=i)},null,512),[[y,e.form_data.id]]),t("div",re,[t("div",ne,[t("div",le,[de,m(t("input",{type:"text",class:"form-control",id:"name",name:"name",placeholder:"Nombre del permiso","onUpdate:modelValue":o[3]||(o[3]=i=>e.form_data.name=i)},null,512),[[y,e.form_data.name]])])])]),e.form_error!=""?(a(),r("div",ce,[t("div",me,[t("h6",_e,n(e.form_error),1)])])):k("",!0),t("div",he,[pe,t("div",fe,[t("div",{class:c(["row mt-3",e.roles_loading?"":"hidden"])},ge,2),t("div",{class:c(["row",!e.roles_loading&&e.permission_roles.length>0?"":"hidden"])},[t("div",be,[t("table",ve,[ye,t("tbody",null,[(a(!0),r(f,null,v(e.permission_roles,(i,p)=>(a(),r("tr",{key:i.id},[t("td",ke,n(p+1),1),t("td",null,n(i.name),1),t("td",xe,[t("input",{type:"checkbox",class:"form-check-input ml-0",id:"role_active",name:"role_active",checked:i.active,onChange:g=>d.activeRole(p)},null,40,we)])]))),128))])])])],2)])])])]),t("div",Ce,[Ee,t("button",{type:"button",class:c(["btn btn-primary ripple","btn-"+e.form_color]),disabled:e.form_loading,onClick:o[4]||(o[4]=b(i=>d.store(),["stop"]))},[e.form_loading?(a(),r("i",Pe)):(a(),r("i",Ne)),_(" \xA0"+n(e.form_okbtn_text),1)],10,Ae)])])])]),t("div",je,[t("div",ze,[t("div",Re,[t("div",Se,[Be,t("button",Me,Ve,512)]),t("div",Ue,[De,t("div",Ie,[t("p",null,[_('El Permiso "'),t("strong",null,n(e.delete_permission),1),_('" ser\xE1 Eliminado de la plataforma Semtinel.'),$e,_("Confirme que desea realizar esta operaci\xF3n.")])]),e.form_error!=""?(a(),r("div",Fe,[t("div",Ge,[t("h6",He,n(e.form_error),1)])])):k("",!0)]),t("div",Je,[Le,t("button",{type:"button",class:"btn btn-danger ripple",disabled:e.delete_loading,onClick:o[5]||(o[5]=i=>d.destroy())},[Oe,_("\xA0"+n(e.delete_text),1)],8,qe)])])])])],64)}const Xe=x(E,[["render",Ke]]);export{Xe as default};
