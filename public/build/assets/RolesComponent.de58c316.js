import{_ as x}from"./app.523dd8ec.js";import{o as i,e as r,j as t,K as m,M as g,h as _,F as f,J as b,x as d,N as v,k as y,I as h,H as w,L as C}from"./vue.esm-bundler.5523ad96.js";const E={data:function(){return{roles:[],role_permissions:[],permissions_loading:!0,roles_loading:!0,roles_empty:!1,loading:!0,form_title:"Nuevo Rol",form_data:{id:"",name:""},form_action:"",form_error:"",form_okbtn_text:"Aceptar",form_color:"green",form_loading:!1,delete_text:"Eliminar",delete_id:"",delete_role:"",delete_error:"",delete_loading:!1,session:JSON.parse(sessionStorage.getItem("semtinel"))}},created(){},watch:{form_okbtn_text:function(e){e=="Aceptar"?this.form_loading=!1:this.form_loading=!0},form_action:function(e){switch(e){case"create":this.form_color="green";break;case"edit":this.form_color="orange";break;default:this.form_color="danger";break}}},methods:{listReload:function(){this.getItemsTable()},async getItemsTable(){let e=this,o={"User-Agent":"testing/1.0",Accept:"application/json",Authorization:"Bearer "+e.session.access_token};e.roles_loading=!0,fetch("http://localhost/semtinel/api/admin/roles",{method:"GET",headers:o}).then(s=>s.json()).then(s=>{e.roles=s,e.roles_loading=!1,e.roles_empty=!(s.length>0)}).catch(s=>{this.errorMessage=s,toastr.error("Error: "+s)})},activePermission:function(e){this.role_permissions[e].active=!this.role_permissions[e].active},isValidForm:function(){return this.form_data.name==null||this.form_data.name==""?(this.form_error="Debe escribir un Nombre para el rol.",!1):!0},create:function(){let e=this;if(e.form_action="create",e.form_error="",e.form_title="Nuevo Rol",e.form_data.id="",e.form_data.name="",e.role_permissions.length>0)e.role_permissions.forEach((o,s)=>{o.active=!1});else{e.permissions_loading=!0;let o={"User-Agent":"testing/1.0",Accept:"application/json",Authorization:"Bearer "+e.session.access_token};fetch("http://localhost/semtinel/api/admin/role/permissions/0",{method:"GET",headers:o}).then(s=>s.json()).then(s=>{e.role_permissions=s,e.permissions_loading=!1}).catch(s=>{this.errorMessage=s,toastr.error("Error: "+s)})}},edit:function(e,o,s,k){let n=this;n.form_action="edit",n.form_error="",n.form_title="Editar Rol",n.form_data.id=e,n.form_data.name=o,n.permissions_loading=!0;let c={"User-Agent":"testing/1.0",Accept:"application/json",Authorization:"Bearer "+n.session.access_token};fetch("http://localhost/semtinel/api/admin/role/permissions/"+e,{method:"GET",headers:c}).then(l=>l.json()).then(l=>{n.role_permissions=l,n.permissions_loading=!1}).catch(l=>{this.errorMessage=l,toastr.error("Error: "+l)})},deleteDialog:function(e,o){this.delete_id=e,this.delete_role=o},async store(){let e=this;if(!e.isValidForm())return;e.form_error="",e.form_okbtn_text="Procesando...";let o={"User-Agent":"testing/1.0",Accept:"application/json",Authorization:"Bearer "+e.session.access_token};await axios.post("http://localhost/semtinel/api/admin/role",{id:e.form_data.id,name:e.form_data.name,permissions:this.role_permissions},{headers:o}).then(function(s){s.data.success?(e.form_error="",e.form_okbtn_text="Aceptar",e.$refs.Close.click(),e.form_action=="create"?toastr.success("El Rol fue Agregado con \xE9xito."):e.form_action=="edit"&&toastr.success("El Rol fue Actualizado con \xE9xito."),e.listReload()):(e.form_error="",e.form_okbtn_text="Aceptar",e.error("Error al intentar realizar la operaci\xF3n."))}).catch(function(s){e.form_error="Ha ocurrido un error. Por favor, prueba nuevamente.",e.form_okbtn_text="Aceptar"})},async destroy(){let e=this;e.delete_error="",e.delete_loading=!0,e.delete_text="Procesando...";let o={"User-Agent":"testing/1.0",Accept:"application/json",Authorization:"Bearer "+e.session.access_token};await axios.delete("http://localhost/semtinel/api/admin/role/"+e.delete_id,{headers:o},{}).then(function(s){s.data.success?(e.delete_error="",e.delete_loading=!1,e.delete_text="Eliminar",e.$refs.delClose.click(),toastr.success("El Rol fue Eliminado con \xE9xito."),e.listReload()):(e.delete_error="",e.delete_loading=!1,e.delete_text="Eliminar",toastr.error("Error al intentar realizar la operaci\xF3n."))}).catch(function(s){e.delete_error="Ha ocurrido un error. Por favor, prueba nuevamente.",e.form_okbtn_text="Eliminar",e.delete_loading=!1})}},mounted(){JSON.parse(sessionStorage.getItem("semtinel")).access_token||(sessionStorage.clear(),window.document.location.href="http://localhost/semtinel/login"),this.getItemsTable()}},A={class:"container-fluid px-0"},N={class:"card card-default"},R={class:"card-header"},j=t("h3",{class:"card-title"},"Roles",-1),z={class:"card-tools"},B=t("i",{class:"mdi mdi-reload mdi-24px text-green"},null,-1),M=[B],P=t("i",{class:"mdi mdi-plus-circle mdi-24px text-green"},null,-1),S=[P],T={class:"card-body"},V=t("div",{class:"col-12 text-center py-5 loading-table"},[t("h6",null,[t("span",{class:"mdi mdi-loading mdi-spin mdi-36px"},"\xA0Cargando roles...")])],-1),U=[V],D=t("div",{class:"col-12 text-center empty-table"},[t("h6",null,"Ning\xFAn Rol encontrado")],-1),I=[D],$={class:"col-12"},F={class:"table table-striped"},G=t("thead",null,[t("tr",null,[t("th",{width:"50",class:"text-center no-sort"},"No."),t("th",null,"Nombre"),t("th",{width:"100",class:"text-center no-sort"},"Modificar"),t("th",{width:"100",class:"text-center no-sort"},"Eliminar")])],-1),H={class:"text-center"},J={class:"text-center"},L=["onClick"],q=t("span",{class:"mdi mdi-pencil mdi-18px text-orange"},null,-1),O=[q],K={class:"text-center"},Q=["onClick"],W=t("span",{class:"mdi mdi-trash-can-outline mdi-18px text-danger"},null,-1),X=[W],Y={class:"modal fade",id:"modal-role-form","aria-hidden":"true",role:"dialog","data-backdrop":"static","data-keyboard":"false"},Z={class:"modal-dialog"},ee={class:"modal-content"},te={class:"modal-title"},oe={type:"button",ref:"Close",class:"close","data-dismiss":"modal","aria-label":"Close"},se=t("span",{"aria-hidden":"true"},"\xD7",-1),ae=[se],ie={class:"modal-body px-4"},re={class:"row"},le={class:"col-md-12"},ne={class:"form-group"},de=t("label",{for:"name"},"Nombre:",-1),ce={key:0,class:"row pt-2"},_e={class:"col-12 text-center"},me={class:"form_error"},he={class:"card card-default"},pe=w('<div class="card-header"><h3 class="card-title">Permisos</h3><div class="card-tools"><button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i></button></div></div>',1),fe={class:"card-body"},ue=t("div",{class:"col-12 text-center py-5 loading-table"},[t("h6",null,[t("span",{class:"mdi mdi-loading mdi-spin mdi-36px"},"\xA0Cargando permisos...")])],-1),ge=[ue],be={class:"col-12"},ve={class:"table table-striped"},ye=t("thead",null,[t("tr",null,[t("th",{width:"50",class:"text-center no-sort"},"No."),t("th",null,"Nombre"),t("th",{width:"100",class:"text-center no-sort"},"Permite")])],-1),ke={class:"text-center"},xe={class:"text-center"},we=["checked","onChange"],Ce={class:"modal-footer justify-content-between"},Ee=t("button",{type:"button",class:"btn btn-default ripple","data-dismiss":"modal"},"Cancelar",-1),Ae=["disabled"],Ne={key:0,class:"mdi mdi-check-all"},Re={key:1,class:"mdi mdi-loading mdi-spin"},je={class:"modal fade",id:"modal-role-delete","aria-hidden":"true",role:"dialog","data-backdrop":"static","data-keyboard":"false"},ze={class:"modal-dialog modal-lg"},Be={class:"modal-content"},Me={class:"modal-header header-danger"},Pe=t("h4",{class:"modal-title"},"Confirmaci\xF3n",-1),Se={type:"button",ref:"delClose",class:"close","data-dismiss":"modal","aria-label":"Close"},Te=t("span",{"aria-hidden":"true"},"\xD7",-1),Ve=[Te],Ue={class:"modal-body px-4"},De=t("div",{class:"float-start",style:{width:"70px"}},[t("i",{class:"mdi mdi-chat-question mdi-48px"})],-1),Ie={class:"float-start pt-3",style:{width:"85%"}},$e=t("br",null,null,-1),Fe={key:0,class:"row pt-2"},Ge={class:"col-12 text-center"},He={class:"form_error"},Je={class:"modal-footer justify-content-between"},Le=t("button",{type:"button",class:"btn btn-default","data-dismiss":"modal"},"Cancelar",-1),qe=["disabled"],Oe=t("i",{class:"mdi mdi-trash-can-outline"},null,-1);function Ke(e,o,s,k,n,c){const l=C("tooltip");return i(),r(f,null,[t("div",A,[t("div",N,[t("div",R,[j,t("div",z,[m((i(),r("button",{type:"button",class:"btn btn-tool pl-0",onClick:o[0]||(o[0]=g(a=>c.listReload(),["stop"]))},M)),[[l,"Recargar Listado"]]),m((i(),r("button",{type:"button",class:"btn btn-tool pl-0","data-toggle":"modal","data-target":"#modal-role-form",onClick:o[1]||(o[1]=a=>c.create())},S)),[[l,"Nuevo Rol"]])])]),t("div",T,[t("div",{class:_(["row mt-3",e.roles_loading?"":"hidden"])},U,2),t("div",{class:_(["row mt-3",e.roles_empty?"":"hidden"])},I,2),t("div",{class:_(["row",!e.roles_loading&&!e.roles_empty?"":"hidden"])},[t("div",$,[t("table",F,[G,t("tbody",null,[(i(!0),r(f,null,b(e.roles,(a,p)=>(i(),r("tr",{key:a.id},[t("td",H,d(p+1),1),t("td",null,d(a.name),1),t("td",J,[m((i(),r("a",{href:"javascript:void(0);",class:"btn-semti-tool",style:{padding:"4px 5px"},"data-toggle":"modal","data-target":"#modal-role-form",onClick:u=>c.edit(a.id,a.name,a.owner,a.active)},O,8,L)),[[l,"Modificar este Rol"]])]),t("td",K,[m((i(),r("a",{href:"javascript:void(0);",class:"btn-semti-tool",style:{padding:"4px 5px"},"data-toggle":"modal","data-target":"#modal-role-delete",onClick:u=>c.deleteDialog(a.id,a.name)},X,8,Q)),[[l,"Eliminar este Rol"]])])]))),128))])])])],2)])])]),t("div",Y,[t("div",Z,[t("div",ee,[t("div",{class:_(["modal-header","header-"+e.form_color])},[t("h4",te,d(e.form_title),1),t("button",oe,ae,512)],2),t("div",ie,[t("form",null,[m(t("input",{type:"hidden",name:"id_role",id:"id_role","onUpdate:modelValue":o[2]||(o[2]=a=>e.form_data.id=a)},null,512),[[v,e.form_data.id]]),t("div",re,[t("div",le,[t("div",ne,[de,m(t("input",{type:"text",class:"form-control",id:"name",name:"name",placeholder:"Nombre del rol","onUpdate:modelValue":o[3]||(o[3]=a=>e.form_data.name=a)},null,512),[[v,e.form_data.name]])])])]),e.form_error!=""?(i(),r("div",ce,[t("div",_e,[t("h6",me,d(e.form_error),1)])])):y("",!0),t("div",he,[pe,t("div",fe,[t("div",{class:_(["row mt-3",e.permissions_loading?"":"hidden"])},ge,2),t("div",{class:_(["row",!e.permissions_loading&&e.role_permissions.length>0?"":"hidden"])},[t("div",be,[t("table",ve,[ye,t("tbody",null,[(i(!0),r(f,null,b(e.role_permissions,(a,p)=>(i(),r("tr",{key:a.id},[t("td",ke,d(p+1),1),t("td",null,d(a.name),1),t("td",xe,[t("input",{type:"checkbox",class:"form-check-input ml-0",id:"permission_active",name:"permission_active",checked:a.active,onChange:u=>c.activePermission(p)},null,40,we)])]))),128))])])])],2)])])])]),t("div",Ce,[Ee,t("button",{type:"button",class:_(["btn btn-primary ripple","btn-"+e.form_color]),disabled:e.form_loading,onClick:o[4]||(o[4]=g(a=>c.store(),["stop"]))},[e.form_loading?(i(),r("i",Re)):(i(),r("i",Ne)),h(" \xA0"+d(e.form_okbtn_text),1)],10,Ae)])])])]),t("div",je,[t("div",ze,[t("div",Be,[t("div",Me,[Pe,t("button",Se,Ve,512)]),t("div",Ue,[De,t("div",Ie,[t("p",null,[h('El Rol "'),t("strong",null,d(e.delete_role),1),h('" ser\xE1 Eliminado de la plataforma Semtinel.'),$e,h("Confirme que desea realizar esta operaci\xF3n.")])]),e.form_error!=""?(i(),r("div",Fe,[t("div",Ge,[t("h6",He,d(e.form_error),1)])])):y("",!0)]),t("div",Je,[Le,t("button",{type:"button",class:"btn btn-danger ripple",disabled:e.delete_loading,onClick:o[5]||(o[5]=a=>c.destroy())},[Oe,h("\xA0"+d(e.delete_text),1)],8,qe)])])])])],64)}const Xe=x(E,[["render",Ke]]);export{Xe as default};
