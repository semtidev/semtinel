import{_ as j}from"./app.523dd8ec.js";import{o as a,e as l,j as s,K as r,M as C,h,F as g,J as v,x as n,N as b,k as E,U as w,P as x,I as y,H as k,L as U}from"./vue.esm-bundler.5523ad96.js";const i=axios.create({baseURL:"http://localhost/semtinel/api/",withCredentials:!1}),M={data:function(){return{users:[],roles:[],systems:[],projects:[],poles:[],role_permissions:[],roles_loading:!0,projects_loading:!1,poles_loading:!0,users_loading:!0,users_empty:!1,loading:!0,form_title:"Nuevo Usuario",systems_loading:!0,id:"",name:"",username:"",email:"",password:"",repassword:"",selected_roles:[],selected_systems:[],selected_projects:[],selected_pole:"",form_action:"",form_error:"",form_okbtn_text:"Aceptar",form_color:"green",form_loading:!1,delete_text:"Eliminar",delete_id:"",delete_user:"",delete_error:"",delete_loading:!1,session:JSON.parse(sessionStorage.getItem("semtinel"))}},computed:{classValid(){let e=this;return{"is-invalid":e.password!==e.repassword}}},watch:{selected_pole:function(e){this.projects_loading=!0,e===""?(this.projects=[],this.projects_loading=!1):i.get("/projectsbypole/"+e,{headers:this.headers}).then(t=>{this.projects=t.data,this.projects_loading=!1}).catch(t=>{this.errorMessage=t,toastr.error("Error: "+t)})},form_okbtn_text:function(e){e=="Aceptar"?this.form_loading=!1:this.form_loading=!0},form_action:function(e){switch(e){case"create":this.form_color="green";break;case"edit":this.form_color="orange";break;default:this.form_color="danger";break}}},methods:{listReload:function(){this.getItemsTable()},getItemsTable(){let e=this;e.users_loading=!0,i.get("/admin/users",{headers:this.headers}).then(t=>{e.users=t.data,e.users_loading=!1,e.users_empty=!(t.data.length>0)}).catch(t=>{this.errorMessage=t,toastr.error("Error: "+t)})},isValidForm:function(){return this.name==null||this.name==""?(this.form_error="Debe escribir un Nombre.",!1):!0},getRoles:function(){this.roles_loading=!0,i.get("/admin/roles",{headers:this.headers}).then(e=>{this.roles=e.data,this.roles_loading=!1}).catch(e=>{this.errorMessage=e,toastr.error("Error: "+e)})},getAsignedRoles:function(e){i.get("/admin/roles",{headers:this.headers}).then(t=>{this.roles=t.data,i.get("/admin/user/roles/"+e,{headers:this.headers}).then(d=>{let _=d.data.map(m=>m.id);this.selected_roles=[..._],this.roles_loading=!1}).catch(d=>{this.errorMessage=d,toastr.error("Error: "+d)})}).catch(t=>{this.errorMessage=t,toastr.error("Error: "+t)})},getSystems:function(){i.get("/admin/systems",{headers:this.headers}).then(e=>{let t=e.data.filter(d=>d.active===1);this.systems=t,this.systems_loading=!1}).catch(e=>{this.errorMessage=e,toastr.error("Error: "+e)})},getPoles:function(){i.get("/poles",{headers:this.headers}).then(e=>{let t=e.data.filter(d=>d.active===1);this.poles=t,this.poles_loading=!1}).catch(e=>{this.errorMessage=e,toastr.error("Error: "+e)})},getAsignedSystems:function(e){i.get("/admin/systems",{headers:this.headers}).then(t=>{let d=t.data.filter(_=>_.active===1);this.systems=d,i.get("/admin/user/systems/"+e,{headers:this.headers}).then(_=>{let m=_.data.map(c=>c.id);this.selected_systems=[...m],this.systems_loading=!1}).catch(_=>{this.errorMessage=_,toastr.error("Error: "+_)})}).catch(t=>{this.errorMessage=t,toastr.error("Error: "+t)})},getAsignedProjects:function(e,t){i.get("/poles",{headers:this.headers}).then(d=>{let _=d.data.filter(m=>m.active===1);this.poles=_,i.get("/admin/user/projects/"+e,{headers:this.headers}).then(m=>{let c=m.data.map(p=>p.id);this.selected_projects=[...c],this.selected_pole=t,this.projects_loading=!1}).catch(m=>{this.errorMessage=m,toastr.error("Error: "+m)})}).catch(d=>{this.errorMessage=d,toastr.error("Error: "+d)})},create:function(){let e=this;e.form_action="create",e.form_error="",e.form_title="Nuevo Usuario",e.id="",e.name="",e.username="",e.email="",e.password="",e.repassword="",e.selected_pole="",e.selected_projects=[],e.selected_systems=[],e.selected_roles=[],this.getRoles(),this.getSystems(),this.getPoles()},edit:function(e){let t=this;t.form_action="edit",t.form_error="",t.form_title="Editar Usuario",console.log(e),t.id=e.id,t.name=e.first_name,t.username=e.username,t.email=e.email,this.getAsignedRoles(e.id),this.getAsignedSystems(e.id),this.getAsignedProjects(e.id,e.pole_id)},deleteDialog:function(e,t){this.delete_id=e,this.delete_user=t},store:function(){let e=this;e.form_error="",e.form_okbtn_text="Procesando...",i.post("/user/register",{first_name:e.name,email:e.email,username:e.username,password:e.password,syst_pole_id:e.selected_pole,roles:e.selected_roles,systems:e.selected_systems,projects:e.selected_projects},{headers:this.headers}).then(t=>{e.form_okbtn_text="Aceptar",toastr.success("El Usuario fue creado con \xE9xito."),e.$refs.Close.click(),e.listReload()}).catch(t=>{this.errorMessage=t,toastr.error("Error: "+t)})},update:function(){let e=this;e.form_error="",e.form_okbtn_text="Procesando...",i.put("/user",{id:e.id,first_name:e.name,email:e.email,username:e.username,password:e.password,syst_pole_id:e.selected_pole,roles:e.selected_roles,systems:e.selected_systems,projects:e.selected_projects},{headers:this.headers}).then(t=>{e.form_okbtn_text="Aceptar",toastr.success("El usuario fue actualizado con \xE9xito."),e.$refs.Close.click(),e.listReload()}).catch(t=>{this.errorMessage=t,toastr.error("Error: "+t)})},submitHandler:function(){this.form_action==="create"?this.store():this.update()},destroy:function(){let e=this;e.delete_error="",e.delete_loading=!0,e.delete_text="Procesando...",i.delete("/user/"+e.delete_id,{headers:this.headers},{}).then(t=>{t.data.success?(e.delete_error="",e.delete_loading=!1,e.delete_text="Eliminar",e.$refs.delClose.click(),toastr.success("El usuario fue Eliminado con \xE9xito."),e.listReload()):(e.delete_error="",e.delete_loading=!1,e.delete_text="Eliminar",toastr.error("Error al intentar realizar la operaci\xF3n."))}).catch(function(t){e.delete_error="Ha ocurrido un error. Por favor, prueba nuevamente.",e.form_okbtn_text="Eliminar",e.delete_loading=!1})}},mounted(){const e=JSON.parse(sessionStorage.getItem("semtinel")).access_token;e||(sessionStorage.clear(),window.document.location.href="http://localhost/semtinel/login"),this.headers={Authorization:"Bearer "+e},this.getItemsTable()}},N={class:"container-fluid px-0"},S={class:"card card-default"},V={class:"card-header"},P=s("h3",{class:"card-title"},"Usuarios",-1),R={class:"card-tools"},A=s("i",{class:"mdi mdi-reload mdi-24px text-green"},null,-1),q=[A],I=s("i",{class:"mdi mdi-plus-circle mdi-24px text-green"},null,-1),D=[I],z={class:"card-body"},H=s("div",{class:"col-12 text-center py-5 loading-table"},[s("h6",null,[s("span",{class:"mdi mdi-loading mdi-spin mdi-36px"},"\xA0Cargando usuarios...")])],-1),T=[H],B=s("div",{class:"col-12 text-center empty-table"},[s("h6",null,"Ning\xFAn usuario encontrado")],-1),L=[B],$={class:"col-12"},F={class:"table table-striped"},J=s("thead",null,[s("tr",null,[s("th",{width:"50",class:"text-center no-sort"},"No."),s("th",null,"Nombre"),s("th",null,"Email"),s("th",null,"Usuario"),s("th",{width:"100",class:"text-center no-sort"},"Modificar"),s("th",{width:"100",class:"text-center no-sort"},"Eliminar")])],-1),O={class:"text-center"},K={class:"text-center"},G=["onClick"],Q=s("span",{class:"mdi mdi-pencil mdi-18px text-orange"},null,-1),W=[Q],X={class:"text-center"},Y=["onClick"],Z=s("span",{class:"mdi mdi-trash-can-outline mdi-18px text-danger"},null,-1),ee=[Z],se={class:"modal fade",id:"modal-user-form","aria-hidden":"true",role:"dialog","data-backdrop":"static","data-keyboard":"false"},te={class:"modal-dialog"},oe={class:"modal-content"},ae={class:"modal-title"},le={type:"button",ref:"Close",class:"close","data-dismiss":"modal","aria-label":"Close"},de=s("span",{"aria-hidden":"true"},"\xD7",-1),re=[de],ie={class:"modal-body px-4"},ne={class:"row"},ce={class:"col-md-12"},he={class:"form-group"},_e=s("label",{for:"name"},"Nombre:",-1),me={class:"row"},ue={class:"col-md-12"},pe={class:"form-group"},fe=s("label",{for:"name"},"Usuario:",-1),ge={class:"row"},be={class:"col-md-12"},ve={class:"form-group"},ye=s("label",{for:"name"},"Email:",-1),we={class:"row"},ke={class:"col-md-12"},Ce={class:"form-group"},Ee=s("label",{for:"password"},"Contrase\xF1a:",-1),je={key:0},xe=["required"],Ue={class:"row"},Me={class:"col-md-12"},Ne={class:"form-group"},Se=s("label",{for:"re-password"},"Repetir Contrase\xF1a:",-1),Ve=["required"],Pe=s("div",{class:"invalid-feedback"}," No coincide la contrase\xF1a ",-1),Re={class:"card card-default"},Ae=k('<div class="card-header"><h3 class="card-title">Roles</h3><div class="card-tools"><button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i></button></div></div>',1),qe={class:"card-body"},Ie=s("div",{class:"col-12 text-center py-5 loading-table"},[s("h6",null,[s("span",{class:"mdi mdi-loading mdi-spin mdi-36px"},"\xA0Cargando Roles...")])],-1),De=[Ie],ze={class:"col-12"},He={class:"table table-striped"},Te=s("thead",null,[s("tr",null,[s("th",null,"Nombre"),s("th",{width:"100",class:"text-center no-sort"},"Permite")])],-1),Be={class:"text-center"},Le=["id","value"],$e={class:"card card-default"},Fe=k('<div class="card-header"><h3 class="card-title">Sistemas</h3><div class="card-tools"><button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i></button></div></div>',1),Je={class:"card-body"},Oe=s("div",{class:"col-12 text-center py-5 loading-table"},[s("h6",null,[s("span",{class:"mdi mdi-loading mdi-spin mdi-36px"},"\xA0Cargando Sistemas...")])],-1),Ke=[Oe],Ge={class:"col-12"},Qe={class:"table table-striped"},We=s("thead",null,[s("tr",null,[s("th",null,"Nombre"),s("th",{width:"100",class:"text-center no-sort"},"Permite")])],-1),Xe={class:"text-center"},Ye=["id","value"],Ze={class:"row"},es={class:"col-md-12"},ss={class:"form-group"},ts=s("label",{for:"name"},"Polos:",-1),os=s("option",{disable:"",value:""},"Selecciona un Polo",-1),as=["value"],ls={class:"card card-default"},ds=k('<div class="card-header"><h3 class="card-title">Proyectos</h3><div class="card-tools"><button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i></button></div></div>',1),rs={class:"card-body"},is=s("div",{class:"col-12 text-center py-5 loading-table"},[s("h6",null,[s("span",{class:"mdi mdi-loading mdi-spin mdi-36px"},"\xA0Cargando Proyectos...")])],-1),ns=[is],cs={class:"col-12"},hs={class:"table table-striped"},_s=s("thead",null,[s("tr",null,[s("th",null,"Nombre"),s("th",{width:"100",class:"text-center no-sort"},"Permite")])],-1),ms={class:"text-center"},us=["id","value"],ps={class:"modal-footer justify-content-between"},fs=s("button",{type:"button",class:"btn btn-default ripple","data-dismiss":"modal"},"Cancelar",-1),gs=["disabled"],bs={key:0,class:"mdi mdi-check-all"},vs={key:1,class:"mdi mdi-loading mdi-spin"},ys={class:"modal fade",id:"modal-role-delete","aria-hidden":"true",role:"dialog","data-backdrop":"static","data-keyboard":"false"},ws={class:"modal-dialog modal-lg"},ks={class:"modal-content"},Cs={class:"modal-header header-danger"},Es=s("h4",{class:"modal-title"},"Confirmaci\xF3n",-1),js={type:"button",ref:"delClose",class:"close","data-dismiss":"modal","aria-label":"Close"},xs=s("span",{"aria-hidden":"true"},"\xD7",-1),Us=[xs],Ms={class:"modal-body px-4"},Ns=s("div",{class:"float-start",style:{width:"70px"}},[s("i",{class:"mdi mdi-chat-question mdi-48px"})],-1),Ss={class:"float-start pt-3",style:{width:"85%"}},Vs=s("br",null,null,-1),Ps={key:0,class:"row pt-2"},Rs={class:"col-12 text-center"},As={class:"form_error"},qs={class:"modal-footer justify-content-between"},Is=s("button",{type:"button",class:"btn btn-default","data-dismiss":"modal"},"Cancelar",-1),Ds=["disabled"],zs=s("i",{class:"mdi mdi-trash-can-outline"},null,-1);function Hs(e,t,d,_,m,c){const p=U("tooltip");return a(),l(g,null,[s("div",N,[s("div",S,[s("div",V,[P,s("div",R,[r((a(),l("button",{type:"button",class:"btn btn-tool pl-0",onClick:t[0]||(t[0]=C(o=>c.listReload(),["stop"]))},q)),[[p,"Recargar Listado"]]),r((a(),l("button",{type:"button",class:"btn btn-tool pl-0","data-toggle":"modal","data-target":"#modal-user-form",onClick:t[1]||(t[1]=o=>c.create())},D)),[[p,"Nuevo Usuario"]])])]),s("div",z,[s("div",{class:h(["row mt-3",e.users_loading?"":"hidden"])},T,2),s("div",{class:h(["row mt-3",e.users_empty?"":"hidden"])},L,2),s("div",{class:h(["row",!e.users_loading&&!e.users_empty?"":"hidden"])},[s("div",$,[s("table",F,[J,s("tbody",null,[(a(!0),l(g,null,v(e.users,(o,f)=>(a(),l("tr",{key:o.id},[s("td",O,n(f+1),1),s("td",null,n(o.first_name),1),s("td",null,n(o.email),1),s("td",null,n(o.username),1),s("td",K,[r((a(),l("a",{href:"javascript:void(0);",class:"btn-semti-tool",style:{padding:"4px 5px"},"data-toggle":"modal","data-target":"#modal-user-form",onClick:u=>c.edit(o)},W,8,G)),[[p,"Modificar este usuario"]])]),s("td",X,[r((a(),l("a",{href:"javascript:void(0);",class:"btn-semti-tool",style:{padding:"4px 5px"},"data-toggle":"modal","data-target":"#modal-role-delete",onClick:u=>c.deleteDialog(o.id,o.username)},ee,8,Y)),[[p,"Eliminar este usuario"]])])]))),128))])])])],2)])])]),s("div",se,[s("div",te,[s("div",oe,[s("div",{class:h(["modal-header","header-"+e.form_color])},[s("h4",ae,n(e.form_title),1),s("button",le,re,512)],2),s("div",ie,[s("form",{onSubmit:t[12]||(t[12]=C((...o)=>c.submitHandler&&c.submitHandler(...o),["prevent"]))},[r(s("input",{type:"hidden",name:"id_role",id:"id_role","onUpdate:modelValue":t[2]||(t[2]=o=>e.id=o)},null,512),[[b,e.id]]),s("div",ne,[s("div",ce,[s("div",he,[_e,r(s("input",{type:"text",class:"form-control",id:"name",name:"name",required:"",placeholder:"Nombre del usuario","onUpdate:modelValue":t[3]||(t[3]=o=>e.name=o)},null,512),[[b,e.name]])])])]),s("div",me,[s("div",ue,[s("div",pe,[fe,r(s("input",{type:"text",class:"form-control",id:"username",name:"username",autocomplete:"off",required:"",placeholder:"Identificador de usuario","onUpdate:modelValue":t[4]||(t[4]=o=>e.username=o)},null,512),[[b,e.username]])])])]),s("div",ge,[s("div",be,[s("div",ve,[ye,r(s("input",{class:"form-control",id:"email",name:"email",type:"email",required:"",placeholder:"Correo electr\xF3nico","onUpdate:modelValue":t[5]||(t[5]=o=>e.email=o)},null,512),[[b,e.email]])])])]),s("div",we,[s("div",ke,[s("div",Ce,[Ee,e.form_action==="edit"?(a(),l("div",je,"Si no desea cambiar Contrase\xF1a deje el campo en blanco")):E("",!0),r(s("input",{type:"password",class:"form-control",id:"password",required:e.form_action==="create",autocomplete:"off",name:"password",placeholder:"Escribe una contrase\xF1a","onUpdate:modelValue":t[6]||(t[6]=o=>e.password=o)},null,8,xe),[[b,e.password]])])])]),s("div",Ue,[s("div",Me,[s("div",Ne,[Se,r(s("input",{type:"password",class:h(["form-control",c.classValid]),id:"re-password",required:e.form_action==="create",autocomplete:"off",name:"re-password",placeholder:"Repetir la contrase\xF1a","onUpdate:modelValue":t[7]||(t[7]=o=>e.repassword=o)},null,10,Ve),[[b,e.repassword]]),Pe])])]),s("div",Re,[Ae,s("div",qe,[s("div",{class:h(["row mt-3",e.roles_loading?"":"hidden"])},De,2),s("div",{class:h(["row",!e.roles_loading>0?"":"hidden"])},[s("div",ze,[s("table",He,[Te,s("tbody",null,[(a(!0),l(g,null,v(e.roles,(o,f)=>(a(),l("tr",{key:o.id},[s("td",null,n(o.name),1),s("td",Be,[r(s("input",{type:"checkbox",class:"form-check-input ml-0",id:o.id,value:o.id,"onUpdate:modelValue":t[8]||(t[8]=u=>e.selected_roles=u)},null,8,Le),[[w,e.selected_roles]])])]))),128))])])])],2)])]),s("div",$e,[Fe,s("div",Je,[s("div",{class:h(["row mt-3",e.systems_loading?"":"hidden"])},Ke,2),s("div",{class:h(["row",!e.systems_loading>0?"":"hidden"])},[s("div",Ge,[s("table",Qe,[We,s("tbody",null,[(a(!0),l(g,null,v(e.systems,(o,f)=>(a(),l("tr",{key:o.id},[s("td",null,n(o.name),1),s("td",Xe,[r(s("input",{type:"checkbox",class:"form-check-input ml-0",id:o.id,value:o.id,"onUpdate:modelValue":t[9]||(t[9]=u=>e.selected_systems=u)},null,8,Ye),[[w,e.selected_systems]])])]))),128))])])])],2)])]),s("div",Ze,[s("div",es,[s("div",ss,[ts,r(s("select",{class:"form-select","aria-label":"Selecionar Polo",name:"pole","onUpdate:modelValue":t[10]||(t[10]=o=>e.selected_pole=o)},[os,(a(!0),l(g,null,v(e.poles,(o,f)=>(a(),l("option",{key:f,value:o.id},n(o.name),9,as))),128))],512),[[x,e.selected_pole]])])])]),s("div",ls,[ds,s("div",rs,[s("div",{class:h(["row mt-3",e.projects_loading?"":"hidden"])},ns,2),s("div",{class:h(["row",!e.projects_loading>0?"":"hidden"])},[s("div",cs,[s("table",hs,[_s,s("tbody",null,[(a(!0),l(g,null,v(e.projects,(o,f)=>(a(),l("tr",{key:o.id},[s("td",null,n(o.name),1),s("td",ms,[r(s("input",{type:"checkbox",class:"form-check-input ml-0",id:o.id,value:o.id,"onUpdate:modelValue":t[11]||(t[11]=u=>e.selected_projects=u)},null,8,us),[[w,e.selected_projects]])])]))),128))])])])],2)])]),s("div",ps,[fs,s("button",{type:"submit",class:h(["btn btn-primary ripple","btn-"+e.form_color]),disabled:e.form_loading},[e.form_loading?(a(),l("i",vs)):(a(),l("i",bs)),y(" \xA0"+n(e.form_okbtn_text),1)],10,gs)])],32)])])])]),s("div",ys,[s("div",ws,[s("div",ks,[s("div",Cs,[Es,s("button",js,Us,512)]),s("div",Ms,[Ns,s("div",Ss,[s("p",null,[y('El usuario "'),s("strong",null,n(e.delete_user),1),y('" ser\xE1 Eliminado de la plataforma Semtinel.'),Vs,y("Confirme que desea realizar esta operaci\xF3n.")])]),e.form_error!=""?(a(),l("div",Ps,[s("div",Rs,[s("h6",As,n(e.form_error),1)])])):E("",!0)]),s("div",qs,[Is,s("button",{type:"button",class:"btn btn-danger ripple",disabled:e.delete_loading,onClick:t[13]||(t[13]=o=>c.destroy())},[zs,y("\xA0"+n(e.delete_text),1)],8,Ds)])])])])],64)}const Ls=j(M,[["render",Hs]]);export{Ls as default};
